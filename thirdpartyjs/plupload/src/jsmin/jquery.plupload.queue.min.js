(function(a){function j(i){return plupload.translate(i)||i}function t(i,m){m.contents().each(function(o,l){l=a(l);l.is(".plupload")||l.remove()});m.prepend('<div class="plupload_wrapper plupload_scroll"><div id="'+i+'_container" class="plupload_container"><div class="plupload"><div class="plupload_header"><div class="plupload_header_content"><div class="plupload_header_title">'+j("Select files")+'</div><div class="plupload_header_text">'+j("Add files to the upload queue and click the start button.")+
'</div></div></div><div class="plupload_content"><div class="plupload_filelist_header"><div class="plupload_file_name">'+j("Filename")+'</div><div class="plupload_file_action">&nbsp;</div><div class="plupload_file_status"><span>'+j("Status")+'</span></div><div class="plupload_file_size">'+j("Size")+'</div><div class="plupload_clearer">&nbsp;</div></div><ul id="'+i+'_filelist" class="plupload_filelist"></ul><div class="plupload_filelist_footer"><div class="plupload_file_name"><div class="plupload_buttons"><a href="#" class="plupload_button plupload_add">'+
j("Add files")+'</a><a href="#" class="plupload_button plupload_start">'+j("Start upload")+'</a></div><span class="plupload_upload_status"></span></div><div class="plupload_file_action"></div><div class="plupload_file_status"><span class="plupload_total_status">0%</span></div><div class="plupload_file_size"><span class="plupload_total_file_size">0 b</span></div><div class="plupload_progress"><div class="plupload_progress_container"><div class="plupload_progress_bar"></div></div></div><div class="plupload_clearer">&nbsp;</div></div></div></div></div><input type="hidden" id="'+
i+'_count" name="'+i+'_count" value="0" /></div>')}var p={};a.fn.pluploadQueue=function(i){if(i){this.each(function(){function m(e){var c;if(e.status==plupload.DONE)c="plupload_done";if(e.status==plupload.FAILED)c="plupload_failed";if(e.status==plupload.QUEUED)c="plupload_delete";if(e.status==plupload.UPLOADING)c="plupload_uploading";a("#"+e.id).attr("class",c).find("a").css("display","block")}function o(){a("span.plupload_total_status",d).html(b.total.percent+"%");a("div.plupload_progress_bar",d).css("width",
b.total.percent+"%");a("span.plupload_upload_status",d).text("Uploaded "+b.total.uploaded+"/"+b.files.length+" files");b.total.uploaded==b.files.length&&b.stop()}function l(){var e=a("ul.plupload_filelist",d).html(""),c=0,h;a.each(b.files,function(k,f){h="";if(f.status==plupload.DONE){if(f.target_name)h+='<input type="hidden" name="'+g+"_"+c+'_tmpname" value="'+plupload.xmlEncode(f.target_name)+'" />';h+='<input type="hidden" name="'+g+"_"+c+'_name" value="'+plupload.xmlEncode(f.name)+'" />';h+='<input type="hidden" name="'+
g+"_"+c+'_status" value="'+(f.status==plupload.DONE?"done":"failed")+'" />';c++;a("#"+g+"_count").val(c)}e.append('<li id="'+f.id+'"><div class="plupload_file_name"><span>'+f.name+'</span></div><div class="plupload_file_action"><a href="#"></a></div><div class="plupload_file_status">'+f.percent+'%</div><div class="plupload_file_size">'+plupload.formatSize(f.size)+'</div><div class="plupload_clearer">&nbsp;</div>'+h+"</li>");m(f);a("#"+f.id+".plupload_delete a").click(function(n){a("#"+f.id).remove();
b.removeFile(f);n.preventDefault()})});a("span.plupload_total_file_size",d).html(plupload.formatSize(b.total.size));b.total.queued===0?a("span.plupload_add_text",d).text(j("Add files.")):a("span.plupload_add_text",d).text(b.total.queued+" files queued.");a("a.plupload_start",d).toggleClass("plupload_disabled",b.files.length===0);e[0].scrollTop=e[0].scrollHeight;o();!b.files.length&&b.features.dragdrop&&b.settings.dragdrop&&a("#"+g+"_filelist").append('<li class="plupload_droptext">'+j("Drag files here.")+
"</li>")}var b,d,g;d=a(this);g=d.attr("id");if(!g){g=plupload.guid();d.attr("id",g)}b=new plupload.Uploader(a.extend({dragdrop:true,container:g},i));i.preinit&&i.preinit(b);p[g]=b;b.bind("UploadFile",function(e,c){a("#"+c.id).addClass("plupload_current_file")});b.bind("Init",function(e,c){t(g,d);!i.unique_names&&i.rename&&a("#"+g+"_filelist div.plupload_file_name span",d).live("click",function(h){var k=a(h.target),f,n,q="";f=e.getFile(k.parents("li")[0].id);n=f.name;if(h=/^(.+)(\.[^.]+)$/.exec(n)){n=
h[1];q=h[2]}k.hide().after('<input type="text" />');k.next().val(n).focus().blur(function(){k.show().next().remove()}).keydown(function(r){var s=a(this);if(r.keyCode==13){r.preventDefault();f.name=s.val()+q;k.text(f.name);s.blur()}})});a("a.plupload_add",d).attr("id",g+"_browse");e.settings.browse_button=g+"_browse";if(e.features.dragdrop&&e.settings.dragdrop){e.settings.drop_element=g+"_filelist";a("#"+g+"_filelist").append('<li class="plupload_droptext">'+j("Drag files here.")+"</li>")}a("#"+g+
"_container").attr("title","Using runtime: "+c.runtime);a("a.plupload_start",d).click(function(h){a(this).hasClass("plupload_disabled")||b.start();h.preventDefault()});a("a.plupload_stop",d).click(function(h){b.stop();h.preventDefault()});a("a.plupload_start",d).addClass("plupload_disabled")});b.init();i.setup&&i.setup(b);b.bind("Error",function(e,c){var h=c.file,k;if(h){k=c.message;if(c.details)k+=" ("+c.details+")";a("#"+h.id).attr("class","plupload_failed").find("a").css("display","block").attr("title",
k)}});b.bind("StateChanged",function(){if(b.state===plupload.STARTED){a("li.plupload_delete a,div.plupload_buttons",d).hide();a("span.plupload_upload_status,div.plupload_progress,a.plupload_stop",d).css("display","block");a("span.plupload_upload_status",d).text("Uploaded 0/"+b.files.length+" files")}else{a("a.plupload_stop,div.plupload_progress",d).hide();a("a.plupload_delete",d).css("display","block")}});b.bind("QueueChanged",l);b.bind("StateChanged",function(e){e.state==plupload.STOPPED&&l()});
b.bind("FileUploaded",function(e,c){m(c)});b.bind("UploadProgress",function(e,c){a("#"+c.id+" div.plupload_file_status",d).html(c.percent+"%");m(c);o()})});return this}else return p[a(this[0]).attr("id")]}})(jQuery);
