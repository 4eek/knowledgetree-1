(function(e){function q(d,m,l,n,b){var a,f,c,h,j;a=document.createElement("canvas");a.style.display="none";document.body.appendChild(a);f=a.getContext("2d");c=new Image;c.onload=function(){var i,k;j=Math.min(m/c.width,l/c.height);if(j<1){i=Math.round(c.width*j);k=Math.round(c.height*j)}else{i=c.width;k=c.height}a.width=i;a.height=k;f.drawImage(c,0,0,i,k);h=a.toDataURL(n);h=h.substring(h.indexOf("base64,")+7);h=atob(h);a.parentNode.removeChild(a);b({success:true,data:h})};c.src=d}e.runtimes.Html5=
e.addRuntime("html5",{getFeatures:function(){var d,m,l,n;d=m=l=n=false;if(window.XMLHttpRequest){d=new XMLHttpRequest;m=!!d.upload;d=!!(d.sendAsBinary||d.upload)}if(d){l=!!(File&&File.prototype.getAsDataURL);n=!!(File&&File.prototype.slice)}return{html5:d,dragdrop:window.mozInnerScreenX!==undefined||n,jpgresize:l,pngresize:l,multipart:l,progress:m}},init:function(d,m){function l(b){var a,f,c=[],h;for(f=0;f<b.length;f++){a=b[f];h=e.guid();n[h]=a;c.push(new e.File(h,a.fileName,a.fileSize))}c.length&&
d.trigger("FilesAdded",c)}var n={};if(this.getFeatures().html5){d.bind("Init",function(b){var a,f=[],c,h=b.settings.filters,j,i,k=document.body;a=document.createElement("div");a.id=b.id+"_html5_container";for(b=0;b<h.length;b++){j=h[b].extensions.split(/,/);for(c=0;c<j.length;c++)(i=e.mimeTypes[j[c]])&&f.push(i)}e.extend(a.style,{position:"absolute",background:d.settings.shim_bgcolor||"transparent",width:"100px",height:"100px",overflow:"hidden",display:"none",zIndex:99999,opacity:d.settings.shim_bgcolor?
"":0});a.className="plupload html5";if(d.settings.container){k=document.getElementById(d.settings.container);k.style.position="relative"}k.appendChild(a);a.innerHTML='<input id="'+d.id+'_html5" style="width:100%;" type="file" accept="'+f.join(",")+'" '+(d.settings.multi_selection?'multiple="multiple"':"")+" />";document.getElementById(d.id+"_html5").onchange=function(){l(this.files);this.value=""}});d.bind("PostInit",function(){var b=document.getElementById(d.settings.drop_element);if(b){e.addEvent(b,
"dragover",function(a){a.preventDefault()});e.addEvent(b,"drop",function(a){var f=a.dataTransfer;f&&f.files&&l(f.files);a.preventDefault()})}});d.bind("Refresh",function(b){var a;if(a=document.getElementById(d.settings.browse_button)){b=e.getPos(a,document.getElementById(b.settings.container));a=e.getSize(a);e.extend(document.getElementById(d.id+"_html5_container").style,{top:b.y+"px",left:b.x+"px",width:a.w+"px",height:a.h+"px"})}});d.bind("UploadFile",function(b,a){function f(g){var o="----pluploadboundary"+
e.guid(),p="";if(b.settings.multipart){c.setRequestHeader("Content-Type","multipart/form-data; boundary="+o);e.each(b.settings.multipart_params,function(r,s){p+="--"+o+'\r\nContent-Disposition: form-data; name="'+s+'"\r\n\r\n';p+=r+"\r\n"});p+="--"+o+'\r\nContent-Disposition: form-data; name="'+b.settings.file_data_name+'"; filename="'+a.name+'"\r\nContent-Type: application/octet-stream\r\n\r\n'+g+"\r\n--"+o+"--\r\n";k=p.length-g.length;g=p}c.sendAsBinary(g)}var c=new XMLHttpRequest,h=c.upload,j=
b.settings.resize,i,k=0;if(!(a.status==e.DONE||a.status==e.FAILED||b.state==e.STOPPED)){if(h)h.onprogress=function(g){a.loaded=g.loaded-k;b.trigger("UploadProgress",a)};c.onreadystatechange=function(){var g;if(c.readyState==4){try{g=c.status}catch(o){g=0}a.status=e.DONE;a.loaded=a.size;b.trigger("UploadProgress",a);b.trigger("FileUploaded",a,{response:c.responseText,status:g});g>=400&&b.trigger("Error",{code:e.HTTP_ERROR,message:"HTTP Error.",file:a,status:g})}};c.open("post",e.buildUrl(b.settings.url,
{name:a.target_name||a.name}),true);c.setRequestHeader("Content-Type","application/octet-stream");e.each(b.settings.headers,function(g,o){c.setRequestHeader(o,g)});i=n[a.id];if(c.sendAsBinary)j&&/\.(png|jpg|jpeg)$/i.test(a.name)?q(i.getAsDataURL(),j.width,j.height,/\.png$/i.test(a.name)?"image/png":"image/jpeg",function(g){if(g.success){a.size=g.data.length;f(g.data)}else f(i.getAsBinary())}):f(i.getAsBinary());else c.send(i)}});m({success:true})}else m({success:false})}})})(plupload);
