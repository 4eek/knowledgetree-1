<?php
/**
* Presentation information for renaming a DocType
*
* @author Mukhtar Dharsey
* @date 5 February 2003
* @package presentation.lookAndFeel.knowledgeTree.
*
*/

// if its the manual edit page..then display normally
function getDetailsPage($iDocTypeID) {
    global $default;
    $oDocType = null;
    if (isset($iDocTypeID)) {
        $oDocType = DocumentType::get($iDocTypeID);
    }

    $sToRender .= renderHeading("Edit Document Type");
    
    $sToRender .= "<table border=0 width=100%>\n";
    
    $sToRender .= "<tr>\n";
    $sToRender .= "<td width=\"45%\">Document Type Name: </td><td>" . $oDocType->getName() . "</td>\n";
    $sToRender .= "</tr>\n";
    $sToRender .= "<tr><input type=hidden name=\"fDocTypeID\"  value=\"" . $iDocTypeID . "\"></tr>\n";
    $sToRender .= "<tr></tr>\n";
    $sToRender .= "<tr><td valign=\"top\">Generic Document Fields: </td><td>" . getGenericFieldsList() . "</td></tr>\n";
    $sToRender .= "<tr></tr>\n";
    $sToRender .= "<tr><td valign=\"top\">Document Type Specific Fields: </td>";    
    $sToRender .= "<td>" . getDocumentTypeFieldsList($iDocTypeID) . "</td></tr>\n";	
    $sToRender .= "<tr><td >" . generateControllerLink("addDocTypeFieldsLink", "fDocTypeID=$iDocTypeID", "Add new Type Specific Field &nbsp; <img border=0 src=\"$default->graphicsUrl/widgets/add.gif\"/>");
    $sToRender .= generateControllerLink("listDocTypes", "", "<img border=0 src=\"$default->graphicsUrl/widgets/back.gif\"/>"). "</td></tr>\n";    
    $sToRender .= "</table>\n";

    return $sToRender;
}

function getDeleteConfirmationPage($iDocTypeID, $iDocFieldID) {
	global $default;

    $oDocType = DocumentType::get($iDocTypeID);
    $oDocField = DocumentField::get($iDocFieldID);
	
    $sToRender .= renderHeading("Edit Document Type - Delete Document Field Link");
    $sToRender .= "<table border=\"0\" cellspacing=\"2\" cellpadding=\"2\">\n";
    $sToRender .= "<tr><td>Are you sure you want to remove field '" . $oDocField->getName(). "' from document type '" . $oDocType->getName() ."'?</td></tr>\n";
    $sToRender .= "<tr/><tr/>\n";
    $sToRender .= "<tr><td>Click 'Remove' to remove the link, or 'Cancel' to abort.</td></tr>\n";
    $sToRender .= "<tr/><tr/>\n";
	$sToRender .= "<td align=\"right\">" . generateControllerLink("editDocTypeFields", "fConfirm=1&fRemove=1&fDocFieldID=$iDocFieldID&fDocTypeID=$iDocTypeID", "<img src =\"$default->graphicsUrl/widgets/remove.gif\" border = \"0\" />");
	$sToRender .= generateControllerLink("editDocTypeFields", "fDocTypeID=$iDocTypeID", "<img src =\"$default->graphicsUrl/widgets/cancel.gif\" border = \"0\" />") . "</td>\n";
    $sToRender .= "</table>\n";
    return $sToRender;
}

function getEditDocumentFieldLinkPage($oDocTypeFieldLink) {
    global $default;

    $oDocField = DocumentField::get($oDocTypeFieldLink->getFieldID());	
	
    $sToRender .= renderHeading("Edit Document Type - Update Document Field Link Mandatory Setting");
    $sToRender .= "<table>\n";
	$sToRender .= "<input type=\"hidden\" name=\"fConfirm\" value=\"1\">\n";    
    $sToRender .= "<input type=\"hidden\" name=\"fDocTypeID\" value=\"" . $oDocTypeFieldLink->getDocumentTypeID() . "\">\n";
    $sToRender .= "<input type=\"hidden\" name=\"fDocFieldID\" value=\"" . $oDocTypeFieldLink->getFieldID() . "\">\n";
    $sToRender .= "<tr>\n";
    $sToRender .= "<td>Document Field Name: </td><td>" . $oDocField->getName() . "</td>\n";
    $sToRender .= "</tr>\n";
    $sToRender .= "<tr/>\n";
    $sToRender .= "<tr>\n";
    $sToRender .= "<td>Mandatory:  </td><td><input type=\"checkbox\" name=\"fIsMandatory\" value=\"1\" " . ($oDocTypeFieldLink->getIsMandatory() ? "CHECKED" : "") . "></td>\n";
    $sToRender .= "</tr>\n";
    $sToRender .= "<tr><td><input type=\"image\" src=\"$default->graphicsUrl/widgets/update.gif\"/>";
    $sToRender .= generateControllerLink("editDocTypeFields", "fDocTypeID=" . $oDocTypeFieldLink->getDocumentTypeID(), "<img src =\"$default->graphicsUrl/widgets/cancel.gif\" border = \"0\" />") . "</td></tr>\n";
    $sToRender .= "</table>\n";
    return $sToRender;
}


function getStatusPage($sHeading, $sText = "", $iDocTypeID) {
	global $default;
	
    $sToRender .= renderHeading("Edit Document Type");
    $sToRender .= "<table border=\"0\" cellspacing=\"2\" cellpadding=\"2\">\n";
    $sToRender .= "<tr>\n";
    $sToRender .= "<td><b>$sHeading</b></td>\n";
    $sToRender .= "</tr>\n";
    $sToRender .= "<tr/><tr/>\n";
    $sToRender .= "<tr><td>$sText</td></tr>\n";
    $sToRender .= "<tr/><tr/>\n";
	$sToRender .= "<td align=\"right\">" . generateControllerLink("editDocTypeFields", "fDocTypeID=$iDocTypeID", "<img src =\"$default->graphicsUrl/widgets/back.gif\" border = \"0\" />") . "</td>\n";
    $sToRender .= "</table>\n";
    return $sToRender;
}

// if addition is successful print otu success page
function getSuccessPage($sMessage, $iDocTypeID) {
	return getStatusPage("Success!", $sMessage, $iDocTypeID);
}

// gets the page if editing fails
function getFailurePage($sMessage, $iDocTypeID) {
	return getStatusPage("Failure!", $sMessage, $iDocTypeID);
}

function getGenericFieldsList() {
    global $default;
    $aGenericDocumentFields = DocumentField::getList("is_generic=1");
    for($i = 0; $i < count($aGenericDocumentFields); $i++) {
        $sToRender .= "<li>" . $aGenericDocumentFields[$i]->getName() . "</li>\n";
    }
    return $sToRender;
}

function getDocumentTypeFieldsList($iDocTypeID) {
    global $default;
    $aDocumentTypeFields = DocumentTypeFieldLink::getDocumentTypeFields($iDocTypeID);
	$sToRender .= "<table border=0>";
    for($i = 0; $i < count($aDocumentTypeFields); $i++) {
        $oDocField = $aDocumentTypeFields[$i];
        if ($oDocField) {
	        $oDocumentTypeFieldLink = DocumentTypeFieldLink::getByFieldAndTypeIDs($iDocTypeID, $oDocField->getID());
	        $sToRender .= "<tr>";
	        $sToRender .= "<td>" . $oDocField->getName() . "</td>";
	        $sToRender .= "<td><img src=\"$default->graphicsUrl/widgets/" . ($oDocumentTypeFieldLink->getIsMandatory() ? "checked" : "unchecked") . ".gif\"/></td>";
	        $sToRender .= "<td>" . getEditSpecificFieldButton($oDocField->getID(), $iDocTypeID) . "</td>";
	        $sToRender .= "<td>" . getRemoveSpecificFieldButton($oDocField->getID(), $iDocTypeID) . "</td>";
	        $sToRender .= "</tr>"; 
        } else {
        	// FIXME: what about broken links?        	
        }
    }
	$sToRender .= "</table>\n";    
    return $sToRender;
}

function getEditSpecificFieldButton($iDocFieldID, $iDocTypeID) {
    global $default;
	return generateControllerLink("editDocTypeFields", "fUpdateMandatory=1&fDocFieldID=$iDocFieldID&fDocTypeID=$iDocTypeID", "<img border=0 src =\"$default->graphicsUrl/widgets/edit.gif\" value=\"edit\" />");	
}

function getRemoveSpecificFieldButton($iDocFieldID, $iDocTypeID) {
    global $default;
	return generateControllerLink("editDocTypeFields", "fRemove=1&fDocFieldID=$iDocFieldID&fDocTypeID=$iDocTypeID", "<img border=0 src =\"$default->graphicsUrl/widgets/remove.gif\" value=\"remove\" />");	
}
?>