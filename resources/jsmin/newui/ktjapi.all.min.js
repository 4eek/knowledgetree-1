ktjapi=new function(){this._cache={};this._tokens={};this.debug=true;this.log=false;this.setupSpinner=function(){if(this.cfg.get("spinner",false)!==false)if(!this.cfg.get("spinner.setup",false)){this.hideSpinner();this.cfg.set("spinner.setup",true)}};this.showSpinner=function(){var a=document.getElementById(this.cfg.get("spinner"));try{if(typeof a.style!="undefined")a.style.display=""}catch(e){}};this.hideSpinner=function(){var a=document.getElementById(this.cfg.get("spinner"));try{if(typeof a.style!=
"undefined")a.style.display="none"}catch(e){}};this.init=function(){var a={};a.url="webservice/clienttools/webcomms.php";a.timeout=5E3;a.url!==undefined&&this.cfg.set("server.url",a.url);this.cfg.set("server.timeout",a.timeout!==undefined?a.timeout:2E3);this.cfg.set("errorEventName",a.errorEventName!==undefined?a.errorEventName:"AJAX.ERROR");this.cfg.set("JSONerrorEventName",a.errorEventName!==undefined?a.errorEventName:"AJAX_JSON.ERROR")};this.error=function(a,e,f){a={xhr:a,text:e,error:f};ktjapi.evt.trigger(ktjapi.cfg.get("errorEventName"),
a)};this.getDataSource=function(a,e,f,h){return this.getDataSourceDetail(a,e,f,h).url};this.getDataSourceDetail=function(a,e,f,h){h=h?true:false;f=false;a=(""+a).split(/\./);return this.createURL(this.createPackage(a[0],a[1],e),f,!h)};this.retrieve=function(a,e,f){var h;this.callMethod(a,e,function(k){h=k},true,function(){},f);return h};this.callMethod=function(a,e,f,h,k,l,u){a=(""+a).split(/\./);e=this.createPackage(a[0],a[1],e);if(typeof l!=="undefined"){l+=0;if(l>0)e.request.expires=(new Date).getTime()+
l*1E3}if(this.cacheExists(this.getCacheId(e.request))){l=this.getCache(e.request);if(l!=null){typeof(f=="function")&&f(l);return}}f=function(j){return function(i,w,v){var t;v=v.responseText;try{var x=v.split("|");for(i=0;i<x.length;++i){t=ktjapi._lib.String.json.decode(x[i]);if(t.errors.hadErrors>0)for(w=0;w<t.errors.errors.length;w++);else ktjapi.setCache(t.request.request,t);typeof j=="function"&&j(t)}}catch(g){t={auth:{},data:{},status:{random_token:"",session_id:""},request:{},raw:v,errors:{hadErrors:1,
errors:[{message:"JSON From Server Incorrect",type:""}]}};ktjapi.evt.trigger(ktjapi.cfg.get("JSONerrorEventName"),t)}}}(f);k=typeof k=="function"?k:function(){};l=this.createURL(e,false,false);this.ajax.getRequest(l.url,f,k,h?true:false,u);return l.url};this.handleData=function(a,e){if(a.errors.hadErrors>0)for(var f=0;f<a.errors.errors.length;f++);else ktjapi.setCache(a.request.request,a);typeof e=="function"&&e(a)};this.createPackage=function(a,e,f){this.getNewToken();return{auth:{debug:this.debug,
log:this.log},request:{service:a,"function":e,parameters:this.ensureObject(f),expires:0}}};this.ensureObject=function(a){var e={};if(typeof a=="object")for(var f in a){if(a.hasOwnProperty(f)&&typeof a[f]!=="function")e[f]=this.ensureObject(a[f])}else e=a+"";return e};this.createURL=function(a,e,f){e=e?true:false;var h={},k=null;if(f)h.datasource=1;h.request=ktjapi._lib.String.json.encode(a);a=[];for(var l in h)a[a.length]=l+"="+h[l];if(e){e=this.cfg.get("server.url");k=a.join("&")}else e=this.cfg.get("server.url")+
"?"+a.join("&");return{url:e,data:k}};this.getNewToken=function(){do var a=ktjapi._lib.String.md5(Math.random()+"-"+Math.random());while(typeof this._tokens[a]!=="undefined");this._tokens[a]=true;return a};this.getCacheId=function(a){a=ktjapi._lib.String.json.decode(ktjapi._lib.String.json.encode(a));return reqid=ktjapi._lib.String.md5(ktjapi._lib.String.json.encode({service:a.service,"function":a["function"],parameters:a.parameters}))};this.cacheExists=function(a){return typeof this._cache[a]!==
"undefined"};this.setCache=function(a,e){if(a.expires>0)this._cache[this.getCacheId(a)]={data:e,expires:a.expires}};this.getCache=function(a){if(a.expires>0){a=this.getCacheId(a);if(this.cacheExists(a))if((new Date).getTime()<this._cache[a].expires)return this._cache[a].data;else{this._cache[a]=undefined;return null}}}};
ktjapi.cfg=new function(){this._data={};this.get=function(a){return this._data[a]};this.set=function(a,e){this._data[a]=e};this.remove=function(a){delete this._data[a]};this.initialize=function(a){if(kt.lib.type(a)=="object")for(var e in a)this.set(e,a[e])};this.clear=function(){this._data={}}};
ktjapi._lib=new function(){this._data={};this.getDefault=function(){for(var a=0;a<arguments.length;a++)if(typeof arguments[a]!="undefined")if(new String(arguments[a])!="")return arguments[a]};this.isset=function(a){return kt.lib.type(a)!=undefined};this.is_empty=function(a){if(!kt.lib.isset(a))return false;return""+a!=""};this.rand=function(a,e){a=new Number(this.getDefault(a,0));e=new Number(this.getDefault(e,1E8));return Math.ceil(Math.random()*(e-a)+a)};this.type=function(a){return typeof a};this.randomId=
function(a,e){var f=ktjapi._lib.getDefault(a,"_");e=ktjapi._lib.getDefault(e,16);var h=e-(""+f).length,k=new String("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ01234567890_$"),l=k.length;if(!(h<=5))for(var u=0;u<h;u++){var j=ktjapi._lib.rand(0,l);f+=k[j-1]}return f};this.uniqueId=function(a,e){a=ktjapi._lib.getDefault(a,"_");e=new Number(ktjapi._lib.getDefault(e,16));var f;if(this._data.uniqueIdentifiers===undefined)this._data.uniqueIdentifiers={};do f=this.randomId(a,e);while(this._data.uniqueIdentifiers[f]!=
undefined);this._data.uniqueIdentifiers[f]=true;return f};this.stringToObjectPath=function(a,e){e=e?true:false;a=new String(a);var f=a.split(/\./),h=0,k=window,l=true;do{if(e)if(k[f[h]]===undefined)k[f[h]]={};k=k[f[h++]];if(k===undefined)l=false}while(typeof k=="object"&&h<f.length&&!l);return k}};ktjapi._lib.String=new function(){};
ktjapi._lib.String.md5=function(a){var e=function(m,n){var o,q,s,r,p;s=m&2147483648;r=n&2147483648;o=m&1073741824;q=n&1073741824;p=(m&1073741823)+(n&1073741823);if(o&q)return p^2147483648^s^r;return o|q?p&1073741824?p^3221225472^s^r:p^1073741824^s^r:p^s^r},f=function(m,n,o,q,s,r,p){m=e(m,e(e(n&o|~n&q,s),p));return e(m<<r|m>>>32-r,n)},h=function(m,n,o,q,s,r,p){m=e(m,e(e(n&q|o&~q,s),p));return e(m<<r|m>>>32-r,n)},k=function(m,n,o,q,s,r,p){m=e(m,e(e(n^o^q,s),p));return e(m<<r|m>>>32-r,n)},l=function(m,
n,o,q,s,r,p){m=e(m,e(e(o^(n|~q),s),p));return e(m<<r|m>>>32-r,n)},u=function(m){var n="",o="",q;for(q=0;q<=3;q++){o=m>>>q*8&255;o="0"+o.toString(16);n+=o.substr(o.length-2,2)}return n},j=[],i,w,v,t,x,g,b,c,d;a=ktjapi._lib.String.utf8.encode(a);j=function(m){var n,o=m.length;n=o+8;for(var q=((n-n%64)/64+1)*16,s=Array(q-1),r=0,p=0;p<o;){n=(p-p%4)/4;r=p%4*8;s[n]|=m.charCodeAt(p)<<r;p++}s[(p-p%4)/4]|=128<<p%4*8;s[q-2]=o<<3;s[q-1]=o>>>29;return s}(a);g=1732584193;b=4023233417;c=2562383102;d=271733878;
a=j.length;for(i=0;i<a;i+=16){w=g;v=b;t=c;x=d;g=f(g,b,c,d,j[i+0],7,3614090360);d=f(d,g,b,c,j[i+1],12,3905402710);c=f(c,d,g,b,j[i+2],17,606105819);b=f(b,c,d,g,j[i+3],22,3250441966);g=f(g,b,c,d,j[i+4],7,4118548399);d=f(d,g,b,c,j[i+5],12,1200080426);c=f(c,d,g,b,j[i+6],17,2821735955);b=f(b,c,d,g,j[i+7],22,4249261313);g=f(g,b,c,d,j[i+8],7,1770035416);d=f(d,g,b,c,j[i+9],12,2336552879);c=f(c,d,g,b,j[i+10],17,4294925233);b=f(b,c,d,g,j[i+11],22,2304563134);g=f(g,b,c,d,j[i+12],7,1804603682);d=f(d,g,b,c,j[i+
13],12,4254626195);c=f(c,d,g,b,j[i+14],17,2792965006);b=f(b,c,d,g,j[i+15],22,1236535329);g=h(g,b,c,d,j[i+1],5,4129170786);d=h(d,g,b,c,j[i+6],9,3225465664);c=h(c,d,g,b,j[i+11],14,643717713);b=h(b,c,d,g,j[i+0],20,3921069994);g=h(g,b,c,d,j[i+5],5,3593408605);d=h(d,g,b,c,j[i+10],9,38016083);c=h(c,d,g,b,j[i+15],14,3634488961);b=h(b,c,d,g,j[i+4],20,3889429448);g=h(g,b,c,d,j[i+9],5,568446438);d=h(d,g,b,c,j[i+14],9,3275163606);c=h(c,d,g,b,j[i+3],14,4107603335);b=h(b,c,d,g,j[i+8],20,1163531501);g=h(g,b,c,
d,j[i+13],5,2850285829);d=h(d,g,b,c,j[i+2],9,4243563512);c=h(c,d,g,b,j[i+7],14,1735328473);b=h(b,c,d,g,j[i+12],20,2368359562);g=k(g,b,c,d,j[i+5],4,4294588738);d=k(d,g,b,c,j[i+8],11,2272392833);c=k(c,d,g,b,j[i+11],16,1839030562);b=k(b,c,d,g,j[i+14],23,4259657740);g=k(g,b,c,d,j[i+1],4,2763975236);d=k(d,g,b,c,j[i+4],11,1272893353);c=k(c,d,g,b,j[i+7],16,4139469664);b=k(b,c,d,g,j[i+10],23,3200236656);g=k(g,b,c,d,j[i+13],4,681279174);d=k(d,g,b,c,j[i+0],11,3936430074);c=k(c,d,g,b,j[i+3],16,3572445317);b=
k(b,c,d,g,j[i+6],23,76029189);g=k(g,b,c,d,j[i+9],4,3654602809);d=k(d,g,b,c,j[i+12],11,3873151461);c=k(c,d,g,b,j[i+15],16,530742520);b=k(b,c,d,g,j[i+2],23,3299628645);g=l(g,b,c,d,j[i+0],6,4096336452);d=l(d,g,b,c,j[i+7],10,1126891415);c=l(c,d,g,b,j[i+14],15,2878612391);b=l(b,c,d,g,j[i+5],21,4237533241);g=l(g,b,c,d,j[i+12],6,1700485571);d=l(d,g,b,c,j[i+3],10,2399980690);c=l(c,d,g,b,j[i+10],15,4293915773);b=l(b,c,d,g,j[i+1],21,2240044497);g=l(g,b,c,d,j[i+8],6,1873313359);d=l(d,g,b,c,j[i+15],10,4264355552);
c=l(c,d,g,b,j[i+6],15,2734768916);b=l(b,c,d,g,j[i+13],21,1309151649);g=l(g,b,c,d,j[i+4],6,4149444226);d=l(d,g,b,c,j[i+11],10,3174756917);c=l(c,d,g,b,j[i+2],15,718787259);b=l(b,c,d,g,j[i+9],21,3951481745);g=e(g,w);b=e(b,v);c=e(c,t);d=e(d,x)}return(u(g)+u(b)+u(c)+u(d)).toLowerCase()};
ktjapi._lib.String.json=new function(){this.decode=function(){var b,c,d,m;if(x("toString")){switch(arguments.length){case 2:d=arguments[0];b=arguments[1];break;case 1:if(t[typeof arguments[0]](arguments[0])===Function){d=this;b=arguments[0]}else d=arguments[0];break;default:d=this}if(k.test(d))try{c=f("(".concat(d,")"));if(b&&c!==null&&(m=t[typeof c](c))&&(m===Array||m===Object))for(d in c)c[d]=t[typeof result](result)!==Function&&(c.hasOwnProperty?c.hasOwnProperty(d):c.constructor.prototype[d]!==
c[d])?b(d,c[d]):c[d]}catch(n){}else throw new JSONError("bad data");}return c};this.encode=function(){var b=arguments.length?arguments[0]:this,c,d;if(b===null)c="null";else if(b!==undefined&&(d=t[typeof b](b)))switch(d){case Array:c=[];for(var m=0,n=0,o=b.length;n<o;n++)if(b[n]!==undefined&&(d=ktjapi._lib.String.json.encode(b[n])))c[m++]=d;c="[".concat(c.join(","),"]");break;case Boolean:c=String(b);break;case Date:c='"'.concat(b.getFullYear(),"-",e(b.getMonth()+1),"-",e(b.getDate()),"T",e(b.getHours()),
":",e(b.getMinutes()),":",e(b.getSeconds()),'"');break;case Function:break;case Number:c=isFinite(b)?String(b):"null";break;case String:c='"'.concat(b.replace(u,w).replace(i,v),'"');break;default:m=0;c=[];for(n in b)if(b[n]!==undefined&&(d=ktjapi._lib.String.json.encode(b[n])))c[m++]='"'.concat(n.replace(u,w).replace(i,v),'":',d);c="{".concat(c.join(","),"}")}return c};this.toDate=function(){var b=arguments.length?arguments[0]:this,c;if(l.test(b)){c=new Date;c.setHours(1*b.substr(11,2));c.setMinutes(1*
b.substr(14,2));c.setSeconds(1*b.substr(17,2));c.setMonth(1*b.substr(5,2)-1);c.setDate(1*b.substr(8,2));c.setFullYear(1*b.substr(0,4))}else if(j.test(b))c=new Date(b*1E3);return c};var a={"\u0008":"b","\t":"t","\n":"n","\u000c":"f","\r":"r",'"':'"',"\\":"\\","/":"/"},e=function(b){return b<10?"0".concat(b):b},f=function(b,c,d){d=eval;delete eval;if(typeof eval==="undefined")eval=d;c=eval(""+b);eval=d;return c},h=["","000","00","0",""],k=null,l=/^[0-9]{4}\-[0-9]{2}\-[0-9]{2}T[0-9]{2}:[0-9]{2}:[0-9]{2}$/,
u=/(\x5c|\x2F|\x22|[\x0c-\x0d]|[\x08-\x0a])/g,j=/^([0-9]+|[0-9]+[,\.][0-9]{1,3})$/,i=/([\x00-\x07]|\x0b|[\x0e-\x1f])/g,w=function(b,c){return"\\".concat(a[c])},v=function(b,c){var d=c.charCodeAt(0).toString(16);return"\\u".concat(h[d.length],d)},t={"boolean":function(){return Boolean},"function":function(){return Function},number:function(){return Number},object:function(b){return b instanceof b.constructor?b.constructor:null},string:function(){return String},undefined:function(){return null}},x=
function(b){function c(d,m){m=d[b];delete d[b];try{f(d)}catch(n){d[b]=m;return 1}}return c(Array)&&c(Object)};try{k=/^("(\\.|[^"\\\n\r])*?"|[,:{}\[\]0-9.\-+Eaeflnr-u \n\r\t])+?$/}catch(g){k=/^(true|false|null|\[.*\]|\{.*\}|".*"|\d+|\d+\.\d+)$/}};
ktjapi._lib.String.utf8=new function(){this.encode=function(a){a=new String(a);a=a.replace(/\r\n/g,"\n");for(var e="",f=0;f<a.length;f++){var h=a.charCodeAt(f);if(h<128)e+=String.fromCharCode(h);else{if(h>127&&h<2048)e+=String.fromCharCode(h>>6|192);else{e+=String.fromCharCode(h>>12|224);e+=String.fromCharCode(h>>6&63|128)}e+=String.fromCharCode(h&63|128)}}return e};this.decode=function(a){for(var e="",f=0,h=0,k=0,l;f<a.length;){h=a.charCodeAt(f);if(h<128){e+=String.fromCharCode(h);f++}else if(h>
191&&h<224){k=a.charCodeAt(f+1);e+=String.fromCharCode((h&31)<<6|k&63);f+=2}else{k=a.charCodeAt(f+1);l=a.charCodeAt(f+2);e+=String.fromCharCode((h&15)<<12|(k&63)<<6|l&63);f+=3}}return e}};
ktjapi.ajax=new function(){this.getRequest=function(a,e,f,h,k){h=h?true:false;e=typeof e=="function"?e:function(){};f=typeof f=="function"?f:function(){};var l=ktjapi.cfg.get("server.timeout");if(typeof k!=="undefined")l=k;ktjapi.q.ajax({url:a,success:e,error:f,type:"GET",timeout:l,async:!h})};this.postRequest=function(a,e,f,h,k){k=k?true:false;ktjapi.q.ajax({url:a,success:typeof f=="function"?f:function(){},error:typeof h=="function"?h:function(){},type:"POST",timeout:ktjapi.cfg.get("server.timeout"),
async:!k,data:e})};this._convertObjectToPostData=function(a){var e="";if(typeof a=="object")for(var f in a)e+=(e.length>1?"&":"")+f+"="+a[f];else e=""+a;return e}};
ktjapi.evt=new function(){this._evts={};this._DOMevts={};this._ids={};this._uniqueEventId=function(){var a=null;do a="_"+(new String(Math.random())).replace(/\./,"_");while(this._ids[a]!=undefined);return a};this.DOMlisten=function(){};this.listen=function(a,e){if(this._evts[a]==undefined)this._evts[a]={};var f=this._uniqueEventId();this._evts[a][f]=e;return f};this.detach=function(a){if(this.eventListenerExists(a)){for(var e in this._evts)this._evts[e][a]!=undefined&&delete this._evts[e][a];delete this._ids[a]}};
this.eventListenerExists=function(a){return this._ids[a]!=undefined};this.trigger=function(a,e){if(e===undefined)e={};var f={eventName:a,data:e},h={};if(this._evts[a]!=undefined)for(var k in this._evts[a]){f.listenerId=k;h=this._evts[a][k];h.eval!=undefined&&eval(h.eval);typeof h.func=="function"&&h.func(f);h.obj!==undefined&&typeof h.method=="function"&&h.method.apply(h.obj,[f]);if(h.funcName!==undefined)try{window[h.funcName](f)}catch(l){}}};this.triggerError=function(a,e,f,h){this.trigger("ERROR:"+
a,{title:e,detail:f,fatal:h?true:false})}};ktjapi.q=jQuery;ktjapi.init();
