kt.lib.str_replace=function(b,a,c,d){var e=0,f=0,g="",i="",h=0,j=0;b=[].concat(b);a=[].concat(a);var k=a instanceof Array,l=c instanceof Array;c=[].concat(c);if(d)this.window[d]=0;e=0;for(h=c.length;e<h;e++)if(c[e]!==""){f=0;for(j=b.length;f<j;f++){g=c[e]+"";i=k?a[f]!==undefined?a[f]:"":a[0];c[e]=g.split(b[f]).join(i);if(d&&c[e]!==g)this.window[d]+=(g.length-c[e].length)/b[f].length}}return l?c:c[0]};
kt.lib.parseTemplate=function(b,a){b+="";var c=[],d=[];if(typeof a=="object")for(var e in a){c[c.length]="["+e+"]";d[d.length]=a[e]+""}return kt.lib.str_replace(c,d,b)};
kt.pages.browse=new function(){var b=this;b.curPage=1;b.loading=false;b.limit=5;b.retryIn=3E3;this.addDocumentItem=function(a){a.is_shortcut=a.is_shortcut?"":" not_supported";a.is_immutable=a.is_immutable?"":" not_supported";a.is_checkedout=a.is_checkedout?"":" not_supported";a.document_link=a.document_url;var c=jQuery(jQuery(".fragment.document")[0]).html();c=kt.lib.parseTemplate(c,a);c=jQuery(c);jQuery(".doc.icon",c).attr("style",a.mimeicon);jQuery(".page.page_"+b.curPage).append(c)};this.viewPage=
function(a,c,d){if(b.loading)return b.retry(a,c,d);if(a<1)a=1;var e=jQuery(".paginate>li.page_"+a);if(!(e.length<=0)){var f=false;if(jQuery(".page.page_"+a).length>0){b.showPage(a,e);f=true}if((typeof d=="undefined"||d)&&b.checkRange(a)){b.loading=true;if(!f){jQuery.loading.css.background="#FFFEA1";jQuery.loading(true,{text:"Loading...",effect:"update"})}b.timeout=b.limit*6E3;if(b.timeout<3E4)b.timeout=3E4;jQuery.ajax({url:"/browse.php?action=paging&fFolderId="+c+"&page="+a+'&options={"offset":'+
b.offset+',"limit":'+b.pages+"}",timeout:b.timeout,success:function(g){b.loaded(g,a,e,f)},error:b.loadingFailed})}}};this.retry=function(a,c,d){jQuery.loading(false);jQuery.loading(true,{text:"Busy, please wait...trying again in "+b.retryIn/1E3+" seconds",max:b.retryIn});setTimeout(function(){b.viewPage(a,c,d)},b.retryIn)};this.checkRange=function(a){a=Number(a);var c=Math.floor(b.limit/2);a=b.limit%2!=0?a-c:a-c-1;index=a>0?a:1;limit=index+b.limit;a=[];for(c=index;c<limit;++c)if(!(jQuery(".paginate>li.page_"+
c).length<=0))if(jQuery(".page.page_"+c).length<=0)a[a.length]=c;b.offset=a.length>0?a[0]:0;b.pages=a.length;return a.length>0};this.loaded=function(a,c,d,e){try{var f=jQuery.parseJSON(a)}catch(g){b.loading=false;return}var i=0;jQuery.each(f,function(){++i});if(i>0)for(var h in f){if(c==1)jQuery(".itemContainer").prepend(f[h]);else{for(a=h-1;jQuery(".page.page_"+a).length<=0;)--a;jQuery(".page.page_"+a).after(f[h])}jQuery(".page.page_"+h).hide(0)}if(!e){b.showPage(c,d);jQuery.loading(false)}b.loading=
false};this.loadingFailed=function(){jQuery.loading(false);b.loading=false};this.showPage=function(a,c){jQuery(".page").hide(0,function(){jQuery(".page.page_"+a).show(0)});jQuery(".paginate>li.item").removeClass("highlight");c.addClass("highlight");b.curPage=new Number(a);jQuery("html, body").animate({scrollTop:0},0);var d=jQuery(".page.page_"+b.curPage+" .item .checkbox>input:checkbox:checked:enabled").length;jQuery(".select_all").attr("checked",d>0)};this.nextPage=function(a){b.viewPage(b.curPage+
1,a);return false};this.prevPage=function(a){b.viewPage(b.curPage-1,a);return false};this.selectAllItems=function(){jQuery(".page.page_"+b.curPage+" .item .checkbox > input:checkbox:enabled").each(function(){this.checked||jQuery(this).click();jQuery(this).parents(".item").addClass("highlighted")});b.setBulkActionMenuStatus();return false};this.deSelectAllItems=function(){jQuery(".page.page_"+b.curPage+" .item .checkbox > input:checkbox:enabled").each(function(){this.checked&&jQuery(this).click();
jQuery(this).parents(".item").removeClass("highlighted")});b.setBulkActionMenuStatus();return false};this.setBulkActionMenuStatus=function(){var a=jQuery(".itemContainer .item .checkbox>input:checkbox:checked:enabled").length;if(a>0){jQuery(".browseView.bulkActionMenu td:first-child").removeClass("disabled");jQuery('.browseView.bulkActionMenu td:first-child input[type="submit"]').attr("disabled","");jQuery(".browseView.bulkActionMenu .status").html(a+"&nbsp;Item(s)&nbsp;Selected")}else{jQuery(".browseView.bulkActionMenu td:first-child").addClass("disabled");
jQuery('.browseView.bulkActionMenu td:first-child input[type="submit"]').attr("disabled","disabled");jQuery(".browseView.bulkActionMenu .status").html("")}}};kt.lib.shortcut.add("ctrl+right",kt.pages.browse.nextPage);kt.lib.shortcut.add("ctrl+left",kt.pages.browse.prevPage);kt.lib.shortcut.add("ctrl+a",kt.pages.browse.selectAllItems);kt.lib.shortcut.add("ctrl+shift+a",kt.pages.browse.deSelectAllItems);
jQuery(document).ready(function(){kt.pages.browse.viewPage(1,null,false);jQuery(".actionIcon.comments").click(function(){var b=jQuery(this).parents(".item")[0];b=jQuery(".expanderField",b);jQuery(".expanderField").not(b[0]).hide();b.toggle()});jQuery("table.doc.item input:checkbox").click(function(){kt.pages.browse.setBulkActionMenuStatus();jQuery(this).is(":checked")?jQuery(this).parent().parent().parent().parent().addClass("highlighted"):jQuery(this).parent().parent().parent().parent().removeClass("highlighted")});
jQuery("table.doc.item input:checkbox:checked").parent().parent().parent().parent().addClass("highlighted");jQuery("table.folder.item input:checkbox").click(function(){kt.pages.browse.setBulkActionMenuStatus();jQuery(this).is(":checked")?jQuery(this).parent().parent().parent().parent().addClass("highlighted"):jQuery(this).parent().parent().parent().parent().removeClass("highlighted")});jQuery("table.folder.item input:checkbox:checked").parent().parent().parent().parent().addClass("highlighted");jQuery.browser.msie&&
function(){jQuery(".doc.browseView:first-child .item .actionMenu .actions>ul").css({display:"block",visibility:"hidden"});setTimeout(function(){jQuery(".doc.browseView:first-child .item .actionMenu .actions>ul").css({display:"",visibility:""})},200)}();kt.pages.browse.setBulkActionMenuStatus();jQuery(".browseView.bulkActionMenu .select_all").change(function(){this.checked?kt.pages.browse.selectAllItems():kt.pages.browse.deSelectAllItems()});jQuery("ul.paginate li.item").length==3&&jQuery("ul.paginate").hide()});
